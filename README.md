# 实验二 语义分析

2022春哈尔滨工业大学编译系统课程实验二的代码。

## 目录

- [实验简介](#实验简介)
- [主要工作](#主要工作)
- [使用指南](#使用指南)
  - [编译](#编译)
  - [运行](#运行)
- [开发指南](#开发指南)
  - [文件目录说明](#文件目录说明)
  - [Debug模式编译](#Debug模式编译)
  - [单元测试](#单元测试)
- [已知问题](#已知问题)

## 实验简介

在词法分析和语法分析程序的基础上编写一个程序，对C--源代码进行语义
分析和类型检查，并打印分析结果。

## 主要工作

基于Flex和GNU Bison实现了一个C--语言词法、语法、语义分析器。该分析器可以检测并输出给定程序中的的词法、语法、语义错误。

## 使用指南

### 编译

```sh
# Compile
$ make parser
```

执行`make parser`后将在项目根目录生成可执行文件`C--parser`。

### 运行

若相对路径`test-res/2.1.c`文件中是一段待分析的C--源代码，执行命令`./C--parser test-res/2.1.c`，将在stdout输出分析结果：

```sh
$ ./C--parser test-res/2.1.c
Error type 1 at Line 4: Undefined variable "j".
$ 
```

若不提供输入文件，则默认从stdin读取输入。

## 开发指南

### 文件目录说明

```
filetree 
├── /.vscode/      VS Code配置文件
├── /lib/          依赖库
├── /test/         单元测试代码
├── /test-res/     测试样例
├── C--lexical.l   词法定义
├── C--syntax.y    语法定义
├── syntax_tree.h  语法树数据结构声明
├── syntax_tree.c  语法树数据结构实现
├── sema.h         语义分析相关代码的声明
├── sema.c         语义分析相关代码的实现
├── main.c         主程序
├── Makefile       
├── README.md      本文件
├── LICENSE        授权协议
└── .gitignore
```

### Debug模式编译

在Debug模式下，程序将输出Flex和Bison的运行信息，便于调试。编译命令如下：

```sh
$ make parser-debug
```

执行完成后，项目根目录下将生成可执行文件`C--parser-debug`，使用方式与C--parser相同。

### 单元测试

项目使用[CuTest](http://cutest.sourceforge.net/) 1.5进行单元测试，相关代码在`test/`文件夹下。执行如下命令进行单元测试：

```sh
# 编译全部示例代码
$ make test
```

## 已知问题

1. 当存在语法错误时，会出现内存泄漏。这是因为语法树的释放以树根节点为单位，但同步失败时将无法归约出整棵树的树根节点。由于不考察这方面要求，就没有修复_(:3」∠)_。

2. 错误恢复的文法写得不好，有一定改进空间。

3. 未完成选做要求2.1和2.3。
